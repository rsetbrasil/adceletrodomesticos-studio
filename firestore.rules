
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Regra padrão: nega tudo, a menos que seja permitido por regras mais específicas abaixo.
    match /{document=**} {
      allow read, write: if false;
    }

    // Permite que qualquer pessoa leia a lista de produtos e categorias.
    match /products/{productId} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }

    match /categories/{categoryId} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }

    // Apenas usuários autenticados podem interagir com pedidos.
    match /orders/{orderId} {
      allow read, create, update, delete: if request.auth != null;
    }

    // Apenas usuários autenticados podem ler e escrever em seus próprios
    // documentos ou listar todos os usuários.
    match /users/{userId} {
      allow get, list: if request.auth != null;
      allow create, update, delete: if request.auth != null;
    }
    
    // Apenas usuários autenticados podem ler e criar logs de auditoria.
    match /auditLogs/{logId} {
      allow read, create: if request.auth != null;
    }
    
    // Apenas usuários autenticados podem gerenciar pagamentos de comissão.
    match /commissionPayments/{paymentId} {
        allow read, create, delete: if request.auth != null;
    }

    // Apenas usuários autenticados podem ler e escrever nas configurações.
    match /config/{documentId} {
      allow get, list, create, update, delete: if request.auth != null;
    }
  }
}
